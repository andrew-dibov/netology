{
  "builders": [
    {
      "type": "yandex",
      "token": "xxx",
      "folder_id": "xxx",
      "zone": "ru-central1-a", 
      "image_name": "debian-11-docker",
      "image_description": "debian with docker",
      "source_image_family": "debian-11",
      "subnet_id": "xxx",
      "use_ipv4_nat": true,
      "disk_type": "network-hdd",
      "ssh_username": "debian"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline": [
        "sudo tee /etc/apt/sources.list > /dev/null <<EOF",
        "deb http://deb.debian.org/debian bullseye main",
        "deb http://deb.debian.org/debian bullseye-updates main",
        "deb http://security.debian.org/debian-security bullseye-security main",
        "EOF"
      ]
    },
    {
      "type": "shell", 
      "inline": [
        "sudo apt-get update -y",
        "sudo apt-get install -y ca-certificates curl gnupg lsb-release"
      ]
    },
    {
      "type": "shell",
      "inline": [
        "curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg",
        "echo \"deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null"
      ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo apt-get update -y",
        "sudo apt-get install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin"
      ]
    },
    {
      "type": "shell",
      "inline": [
        "sudo usermod -aG docker debian",
        "sudo systemctl enable docker",
        "sudo systemctl start docker",
        "sudo docker run hello-world"
      ]
    }
  ]
}
